local hasTeleportedToTyrant = false

Main:AddToggle({
    Name = "Auto Farm Tyrant of the Skies",
    Flag = "Main/AutoFarmTyrantOfTheSkies",
    Description = "",
    Default = false,
    Callback = function(Value)
        _G.AutoFarmTyrant = Value
        if Value == false then
            hasTeleportedToTyrant = false -- Reset teleport flag when turning off
        end
    end
})

spawn(function()
    while task.wait() do
        if _G.AutoFarmTyrant then
            pcall(function()
                -- Check if Tyrant exists before trying to teleport
                local mobName = "Tyrant of the Skies"
                local mobFound = false
                local targetMob = nil
                
                -- First check if the mob exists anywhere
                for _, enemy in pairs(game:GetService("Workspace").Enemies:GetChildren()) do
                    if enemy.Name == mobName and enemy:FindFirstChild("Humanoid") and
                       enemy:FindFirstChild("HumanoidRootPart") and enemy.Humanoid.Health > 0 then
                        mobFound = true
                        targetMob = enemy
                        break
                    end
                end
                
                -- If we haven't teleported yet and the mob isn't found, request entrance
                if not hasTeleportedToTyrant then
                    game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("requestEntrance", Vector3.new(-5075.50927734375, 314.5155029296875, -3150.0224609375))
                    task.wait(2) -- Wait longer for the teleport to process
                    hasTeleportedToTyrant = true
                end
                
                -- After teleporting, check again for the mob
                if not mobFound then
                    for _, enemy in pairs(game:GetService("Workspace").Enemies:GetChildren()) do
                        if enemy.Name == mobName and enemy:FindFirstChild("Humanoid") and
                           enemy:FindFirstChild("HumanoidRootPart") and enemy.Humanoid.Health > 0 then
                            mobFound = true
                            targetMob = enemy
                            break
                        end
                    end
                end
                
                -- If mob found after teleporting, attack it
                if mobFound and targetMob then
                    AutoHaki()
                    EquipTool(_G.SelectWeapon or SelectWeapon)
                    targetMob.HumanoidRootPart.CanCollide = false
                    targetMob.Humanoid.WalkSpeed = 0
                    if targetMob:FindFirstChild("Head") then targetMob.Head.CanCollide = false end
                    Tween(targetMob.HumanoidRootPart.CFrame * CFrame.new(0, 20, 0))
                    AttackNoCoolDown()
                else
                    -- If still no mob found, wait before trying again
                    task.wait(2)
                end
            end)
        end
    end
end)
